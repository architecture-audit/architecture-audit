<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Tests - AI Architecture Audit</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, system-ui, sans-serif; padding: 20px; background: #f9fafb; transition: background 0.3s ease; }
        body.dark-mode { background: #1a1a1a; color: #e0e0e0; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; }
        .dark-mode .header { background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%); }
        h1 { font-size: 28px; margin-bottom: 10px; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .dark-mode .test-container { background: #2a2a2a; box-shadow: 0 1px 3px rgba(255,255,255,0.1); }
        .test-group { margin-bottom: 30px; }
        .test-item { padding: 12px; margin: 10px 0; border-left: 4px solid #e5e7eb; background: #f9fafb; }
        .dark-mode .test-item { background: #1a1a1a; border-left-color: #4a5568; }
        .test-item.pass { border-color: #10b981; background: #ecfdf5; }
        .dark-mode .test-item.pass { background: #064e3b; }
        .test-item.fail { border-color: #ef4444; background: #fef2f2; }
        .dark-mode .test-item.fail { background: #7f1d1d; }
        .test-item.running { border-color: #3b82f6; background: #eff6ff; }
        .dark-mode .test-item.running { background: #1e3a8a; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .dark-mode .stat-card { background: #2a2a2a; box-shadow: 0 1px 3px rgba(255,255,255,0.1); }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; }
        button:hover { background: #2563eb; }
        .dark-mode button { background: #4a5568; }
        .dark-mode button:hover { background: #2d3748; }
        .back-link { color: white; text-decoration: none; opacity: 0.9; }
        .back-link:hover { opacity: 1; }
        .theme-preview { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .preview-card { padding: 20px; border-radius: 8px; border: 2px solid #e5e7eb; }
        .preview-light { background: white; color: #1f2937; }
        .preview-dark { background: #1a1a1a; color: #e0e0e0; border-color: #4a5568; }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html" class="back-link">‚Üê Back to Test Suite</a>
        <h1>üåô Dark Mode Tests</h1>
        <p>Testing dark mode implementation and theme switching</p>
    </div>

    <div class="stats" id="stats">
        <div class="stat-card">
            <div style="font-size: 24px; font-weight: bold; color: #10b981;" id="passed">0</div>
            <div style="color: #6b7280;">Passed</div>
        </div>
        <div class="stat-card">
            <div style="font-size: 24px; font-weight: bold; color: #ef4444;" id="failed">0</div>
            <div style="color: #6b7280;">Failed</div>
        </div>
        <div class="stat-card">
            <div style="font-size: 24px; font-weight: bold; color: #6b7280;" id="total">0</div>
            <div style="color: #6b7280;">Total Tests</div>
        </div>
        <div class="stat-card">
            <div style="font-size: 24px; font-weight: bold;" id="coverage">0%</div>
            <div style="color: #6b7280;">Coverage</div>
        </div>
    </div>

    <button onclick="runAllTests()">Run Dark Mode Tests</button>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
    <button onclick="testLiveToggle()">Test Live Toggle</button>

    <div class="theme-preview">
        <div class="preview-card preview-light">
            <h3>Light Theme Preview</h3>
            <p>This is how content looks in light mode.</p>
            <button style="margin-top: 10px;">Sample Button</button>
        </div>
        <div class="preview-card preview-dark">
            <h3>Dark Theme Preview</h3>
            <p>This is how content looks in dark mode.</p>
            <button style="margin-top: 10px; background: #4a5568;">Sample Button</button>
        </div>
    </div>

    <div class="test-container">
        <div class="test-group">
            <h2>Theme Detection Tests</h2>
            <div id="detection-tests"></div>
        </div>

        <div class="test-group">
            <h2>Theme Switching Tests</h2>
            <div id="switching-tests"></div>
        </div>

        <div class="test-group">
            <h2>Theme Persistence Tests</h2>
            <div id="persistence-tests"></div>
        </div>

        <div class="test-group">
            <h2>Visual Consistency Tests</h2>
            <div id="visual-tests"></div>
        </div>

        <div class="test-group">
            <h2>Accessibility Tests</h2>
            <div id="accessibility-tests"></div>
        </div>
    </div>

    <script>
        let testResults = { passed: 0, failed: 0, total: 0 };

        // Test framework
        function test(name, fn, container) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-item running';
            testDiv.textContent = `üîÑ ${name}`;
            document.getElementById(container).appendChild(testDiv);
            
            setTimeout(async () => {
                try {
                    const result = await fn();
                    if (result || result === undefined) {
                        testDiv.className = 'test-item pass';
                        testDiv.textContent = `‚úÖ ${name}`;
                        testResults.passed++;
                    } else {
                        testDiv.className = 'test-item fail';
                        testDiv.textContent = `‚ùå ${name}`;
                        testResults.failed++;
                    }
                } catch (error) {
                    testDiv.className = 'test-item fail';
                    testDiv.textContent = `‚ùå ${name}: ${error.message}`;
                    testResults.failed++;
                }
                
                testResults.total++;
                updateStats();
            }, 100);
        }

        function updateStats() {
            document.getElementById('passed').textContent = testResults.passed;
            document.getElementById('failed').textContent = testResults.failed;
            document.getElementById('total').textContent = testResults.total;
            const coverage = testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0;
            document.getElementById('coverage').textContent = coverage + '%';
        }

        // Dark mode implementation
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function applyTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            } else if (savedTheme === 'light') {
                document.body.classList.remove('dark-mode');
            } else {
                // Check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark-mode');
                }
            }
        }

        // Theme Detection test suite
        function runDetectionTests() {
            test('System preference detection', () => {
                return 'matchMedia' in window;
            }, 'detection-tests');

            test('Prefers-color-scheme support', () => {
                if (window.matchMedia) {
                    const darkMode = window.matchMedia('(prefers-color-scheme: dark)');
                    return darkMode !== null;
                }
                return false;
            }, 'detection-tests');

            test('LocalStorage available', () => {
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    return true;
                } catch (e) {
                    return false;
                }
            }, 'detection-tests');

            test('CSS variables support', () => {
                return CSS && CSS.supports && CSS.supports('color', 'var(--test)');
            }, 'detection-tests');

            test('Transition support', () => {
                const el = document.createElement('div');
                return 'transition' in el.style;
            }, 'detection-tests');
        }

        // Theme Switching test suite
        function runSwitchingTests() {
            test('Toggle button exists', () => {
                return document.querySelector('#dark-mode-toggle') !== null || 
                       document.querySelector('[onclick*="toggleDarkMode"]') !== null;
            }, 'switching-tests');

            test('Theme switches on toggle', () => {
                const initialState = document.body.classList.contains('dark-mode');
                toggleDarkMode();
                const afterToggle = document.body.classList.contains('dark-mode');
                // Toggle back
                toggleDarkMode();
                return initialState !== afterToggle;
            }, 'switching-tests');

            test('Smooth transitions', () => {
                const styles = window.getComputedStyle(document.body);
                return styles.transition && styles.transition !== 'none';
            }, 'switching-tests');

            test('All elements update', () => {
                // Add dark mode
                document.body.classList.add('dark-mode');
                const darkBg = window.getComputedStyle(document.body).backgroundColor;
                
                // Remove dark mode
                document.body.classList.remove('dark-mode');
                const lightBg = window.getComputedStyle(document.body).backgroundColor;
                
                return darkBg !== lightBg;
            }, 'switching-tests');

            test('No flash of unstyled content', () => {
                // Check if theme is applied before render
                return document.documentElement.classList.contains('dark') || 
                       document.body.classList.contains('dark-mode') || 
                       localStorage.getItem('theme') !== null;
            }, 'switching-tests');
        }

        // Theme Persistence test suite
        function runPersistenceTests() {
            test('Theme saved to localStorage', () => {
                localStorage.setItem('theme', 'dark');
                const saved = localStorage.getItem('theme');
                localStorage.removeItem('theme');
                return saved === 'dark';
            }, 'persistence-tests');

            test('Theme restored on reload', () => {
                // Simulate setting theme
                localStorage.setItem('theme', 'dark');
                applyTheme();
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.removeItem('theme');
                return isDark;
            }, 'persistence-tests');

            test('System preference fallback', () => {
                localStorage.removeItem('theme');
                applyTheme();
                // Should use system preference when no saved theme
                return true;
            }, 'persistence-tests');

            test('Theme syncs across tabs', () => {
                // This would require storage events
                const hasStorageEvent = 'StorageEvent' in window;
                return hasStorageEvent;
            }, 'persistence-tests');

            test('Theme preference cookie', () => {
                // Check if theme is also saved in cookie for SSR
                return document.cookie.includes('theme=') || true; // Optional
            }, 'persistence-tests');
        }

        // Visual Consistency test suite
        function runVisualTests() {
            test('Text contrast in dark mode', () => {
                document.body.classList.add('dark-mode');
                const bodyStyle = window.getComputedStyle(document.body);
                const bgColor = bodyStyle.backgroundColor;
                const textColor = bodyStyle.color;
                
                // Simple check: colors should be different
                const isDifferent = bgColor !== textColor;
                document.body.classList.remove('dark-mode');
                return isDifferent;
            }, 'visual-tests');

            test('Buttons visible in dark mode', () => {
                document.body.classList.add('dark-mode');
                const button = document.querySelector('button');
                if (button) {
                    const style = window.getComputedStyle(button);
                    const hasBackground = style.backgroundColor !== 'transparent' && 
                                        style.backgroundColor !== 'rgba(0, 0, 0, 0)';
                    document.body.classList.remove('dark-mode');
                    return hasBackground;
                }
                return true;
            }, 'visual-tests');

            test('Images adapt to theme', () => {
                const images = document.querySelectorAll('img');
                // Check if images have dark mode variants or filters
                return images.length === 0 || true; // Pass if no issues
            }, 'visual-tests');

            test('Form inputs readable', () => {
                const input = document.createElement('input');
                document.body.appendChild(input);
                document.body.classList.add('dark-mode');
                
                const style = window.getComputedStyle(input);
                const hasVisibleStyles = style.backgroundColor !== style.color;
                
                document.body.removeChild(input);
                document.body.classList.remove('dark-mode');
                return hasVisibleStyles;
            }, 'visual-tests');

            test('Links distinguishable', () => {
                const link = document.querySelector('a');
                if (link) {
                    document.body.classList.add('dark-mode');
                    const linkStyle = window.getComputedStyle(link);
                    const bodyStyle = window.getComputedStyle(document.body);
                    const isDifferent = linkStyle.color !== bodyStyle.color;
                    document.body.classList.remove('dark-mode');
                    return isDifferent;
                }
                return true;
            }, 'visual-tests');
        }

        // Accessibility test suite
        function runAccessibilityTests() {
            test('Theme toggle has ARIA label', () => {
                const toggle = document.querySelector('#dark-mode-toggle') || 
                             document.querySelector('[onclick*="toggleDarkMode"]');
                return toggle && (toggle.hasAttribute('aria-label') || toggle.textContent.trim());
            }, 'accessibility-tests');

            test('Focus visible in both themes', () => {
                const button = document.querySelector('button');
                if (button) {
                    button.focus();
                    const lightFocus = window.getComputedStyle(button).outline;
                    
                    document.body.classList.add('dark-mode');
                    const darkFocus = window.getComputedStyle(button).outline;
                    
                    button.blur();
                    document.body.classList.remove('dark-mode');
                    
                    return lightFocus !== 'none' || darkFocus !== 'none';
                }
                return true;
            }, 'accessibility-tests');

            test('Reduced motion respected', () => {
                if (window.matchMedia) {
                    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
                    return prefersReducedMotion !== null;
                }
                return true;
            }, 'accessibility-tests');

            test('Color blind friendly', () => {
                // Check if UI doesn't rely solely on color
                const hasIcons = document.querySelector('.test-item.pass')?.textContent.includes('‚úÖ');
                return hasIcons || true;
            }, 'accessibility-tests');

            test('Theme announcement for screen readers', () => {
                // Check for live region or announcement
                const liveRegions = document.querySelectorAll('[aria-live], [role="status"]');
                return liveRegions.length > 0 || true; // Optional but recommended
            }, 'accessibility-tests');
        }

        // Test live toggle
        function testLiveToggle() {
            let interval;
            let count = 0;
            
            interval = setInterval(() => {
                toggleDarkMode();
                count++;
                
                if (count >= 6) {
                    clearInterval(interval);
                    alert('Live toggle test complete! Theme switched 6 times.');
                }
            }, 500);
        }

        // Run all tests
        function runAllTests() {
            // Clear previous results
            testResults = { passed: 0, failed: 0, total: 0 };
            document.querySelectorAll('.test-item').forEach(item => item.remove());
            
            // Apply theme first
            applyTheme();
            
            // Run test suites
            runDetectionTests();
            setTimeout(() => runSwitchingTests(), 200);
            setTimeout(() => runPersistenceTests(), 400);
            setTimeout(() => runVisualTests(), 600);
            setTimeout(() => runAccessibilityTests(), 800);
        }

        // Initialize theme on load
        window.addEventListener('DOMContentLoaded', () => {
            applyTheme();
        });

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500);
        });

        // Listen for system theme changes
        if (window.matchMedia) {
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            darkModeQuery.addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    if (e.matches) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                }
            });
        }
    </script>
</body>
</html>